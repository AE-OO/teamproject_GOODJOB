<!--HO - 2022.10.05 -->
<!--기업 회원가입 페이지-->
<!--비밀번호 확인 기능 추가중 -> 성공 -->
<!--비밀번호 일치 하지 않아도 pw1으로 DB에 등록(회원가입 완료) 이런 사항 막아야 함 ->일단 막음-->
<!--로그인 중복확인 기능 추가중
    -> 2022.10.06 완료-->
<!--But, 공백이나 특수기호 문제 발생. 정규표현식으로 해결할 수 있을 듯(아직 해결은 안 함)-->
<!--ho - 22.10.17 로그인 폼 기업/개인 통일 위해 로그인, 비밀번호 창 name 통일. loginId,pw 통일(79, 95라인 변경)-->
<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage"
      xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-icon.png">
    <link rel="icon" type="image/png" href="/img/favicon.png">

    <title>회원가입 (기업회원용)</title>

    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet"/>
    <!-- 한글 폰트 -->
    <link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap" rel="stylesheet">

    <!-- Nucleo Icons -->
    <link href="/css/nucleo-icons.css" rel="stylesheet"/>
    <link href="/css/nucleo-svg.css" rel="stylesheet"/>

    <!-- Font Awesome Icons -->
    <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
    <link href="/css/nucleo-svg.css" rel="stylesheet"/>

    <!-- CSS Files -->
    <link id="pagestyle" href="/css/soft-design-system.css?v=1.0.9" rel="stylesheet"/>
    <!--modal files-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css">

    <!--    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script> -->
    <!--    slim버전 쓰면 $.ajax()를 사용할 수 없대. 밑에 코드로 변경-->
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js"></script>

    <style>
        /* 중복아이디 존재하지 않는경우 */
        .id_input_re_1{
            color : #73b973;
            display : none;
        }
        /* 중복아이디 존재하는 경우 */
        .id_input_re_2{
            color : red;
            display : none;
        }
    </style>

</head>

<body class="index-page">
<div class="container py-4">
    <div class="row">
        <div class="col-lg-7 mx-auto d-flex justify-content-center flex-column">
            <h3 class="text-center">회원가입 (기업회원용)</h3>
            <div class="card-body">
            <span style="float: right; font-size: 14px;"><span
                    style="color: rgb(244, 54, 54);">&nbsp;&ast;</span> 는 필수사항 입니다.</span><br/>
            <form role="form" id="contact-form" name="frm" method="post" autocomplete="off"
                  th:action="@{/com/register}" th:object="${companyDTO}">

                <!--                에러 메시지 보여주는 위치           -->
                <div th:replace="/company/formErrors :: formErrorsFragment"></div>

                    <div class="row">
                        <div class="col-md-6">
                            <label th:for="comLoginId">아이디<span style="color: rgb(244, 54, 54);">&nbsp;&ast;</span></label>
                            <div class="input-group">
                                <!--     ho - 22.10.17 th:field변경 memloginId -> loginId (로그인 폼 input name 통일. DTO 필드 loginId,pw 로 통일)-->
                                <input class="form-control" th:field="*{loginId}" placeholder="ID는 3~15자 사이" type="text"
                                       name="id_input" id="id_input" required>
                            </div>
                            <label class="id_input_re_1">사용 가능한 아이디입니다.</label>
                            <label class="id_input_re_2">아이디가 이미 존재합니다.</label>
                        </div>
                        <div class="col-md-6">
                            <label th:for="comName">기업명<span style="color: rgb(244, 54, 54);">&nbsp;&ast;</span></label>
                            <div class="input-group mb-4">
                                <input class="form-control" th:field="*{comName}" placeholder="기업명" type="text" name="name" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label th:for="comPw">비밀번호<span style="color: rgb(244, 54, 54);">&nbsp;&ast;</span></label>
                            <div class="input-group mb-4">
                                <!--                ho - 22.10.17 th:field변경 memPw -> pw (로그인 폼 input name 통일. DTO 필드 loginId,pw 로 통일)-->
                                <input type="password" class="form-control" th:field="*{pw}" id="comPw1" name="comPw1"
                                       placeholder="Password는 3~25자 사이" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label>비밀번호 확인<span style="color: rgb(244, 54, 54);">&nbsp;&ast;</span></label>
                            <div class="input-group">
                                <input type="password" class="form-control" th:field="*{comPw2}" id="comPw2" name="comPw2"
                                       placeholder="Password 한번더 입력!" required onkeyup="passwordConfirm()"><br/>
                            </div>
                            <label id="confirmMsg"></label>
                        </div>
                        <div class="col-md-6">
                            <label th:for="comBusiNum">사업자번호<span style="color: rgb(244, 54, 54);">&nbsp;&ast;</span></label>
                            <div class="input-group mb-4">
                                <input class="form-control" th:field="*{comBusiNum}" type="text" name="comBusiNum" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label th:for="comPhone">전화번호<span style="color: rgb(244, 54, 54);">&nbsp;&ast;</span></label>
                            <div class="input-group">
                                <input type="tel" class="form-control" th:field="*{comPhone}" placeholder="000-0000-0000" name="phone"
                                       required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label th:for="comComdivCode">기업 분류<span style="color: rgb(244, 54, 54);">&nbsp;&ast;</span></label>
                            <div class="input-group mb-4">
                                <select class="form-control" th:field="*{comComdivCode}">
                                    <option value="Major">대기업</option>
                                    <option value="Middle">중견기업(300명이상)</option>
                                    <option value="SMEs">중소기업(300명미만)</option>
                                    <option value="StartUp">스타트업</option>
                                    <option value="Foreign">외국계기업</option>
                                    <option value="Public">국내 공공기관/공기업</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label th:for="comRegCode">지역 선택<span style="color: rgb(244, 54, 54);">&nbsp;&ast;</span></label>
                            <div class="input-group mb-4">
                                <select class="form-control" th:field="*{comRegCode}">
                                    <option value="02">서울특별시</option>
                                    <option value="031">경기도</option>
                                    <option value="032">인천광역시</option>
                                    <option value="033">강원도</option>
                                    <option value="041">충청남도</option>
                                    <option value="042">대전광역시</option>
                                    <option value="043">충청북도</option>
                                    <option value="044">세종특별시</option>
                                    <option value="051">부산광역시</option>
                                    <option value="052">울산광역시</option>
                                    <option value="053">대구광역시</option>
                                    <option value="054">경상북도</option>
                                    <option value="055">경상남도</option>
                                    <option value="061">전라남도</option>
                                    <option value="062">광주광역시</option>
                                    <option value="063">전라북도</option>
                                    <option value="064">제주도</option>
                                </select>
                            </div>
                        </div>
                    </div>

                <!--                    이메일 양식 지정-->
                <div class="col-md px-0">
                    <label th:for="comEmail">이메일<span style="color: rgb(244, 54, 54);">&nbsp;&ast;</span></label>
                    <div class="input-group">
                        <input type="text" class="form-control w-40" th:field="*{comEmail1}" placeholder="goodjob"
                               name="email"
                               required> &nbsp;@ &nbsp;&nbsp;
                        <select class="form-control" th:field="*{comEmail2}">
                            <option value="naver.com">naver.com</option>
                            <option value="daum.net">daum.net</option>
                            <option value="gmail.com">gmail.com</option>
                        </select>
                    </div>
                </div>
                <br/>
                    <div>
                        <div class="col-md-6 px-0">
                            <label th:for="comAddress">주소<span style="color: rgb(244, 54, 54);">&nbsp;&ast;</span></label>
                            <div class="input-group mb-4">
                                <!--              <input type="text" class="form-control" id="address" rows="4" name="address">-->
                                <input type="text" class="form-control" th:field="*{comAddress1}" id="sample6_postcode" placeholder="우편번호" required>
                                <input type="button" onclick="sample6_execDaumPostcode()" value="우편번호 찾기" class="btn bg-gradient-dark w-150 findAddress">
                            </div>
                        </div>

                        <div class="mb-4">
                            <input type="text" class="form-control" th:field="*{comAddress2}" id="sample6_address" placeholder="주소" required><br>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="input-group mb-4">
                                    <input type="text" class="form-control" th:field="*{comAddress3}" id="sample6_detailAddress"
                                           placeholder="상세주소" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="input-group mb-4">
                                    <input type="text" class="form-control" th:field="*{comAddress4}" id="sample6_extraAddress"
                                           placeholder="참고항목">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group mb-4">
                        <label th:for="comInfo">회사 소개<span style="color: rgb(244, 54, 54);">&nbsp;&ast;</span></label>
                        <textarea id="comInfo" name="comInfo" class="form-control" th:field="*{comInfo}" cols="40" rows="8" required></textarea>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-check form-switch mb-4" th:for="comTerms">
                                <!--                                checked 다음에 1이 true라고 하고 값 1 넘기기-->
                                <input class="form-check-input" th:field="*{comTerms}" type="checkbox" id="flexSwitchCheckDefault" value="1"
                                       checked="" required>
                                <label class="form-check-label" for="flexSwitchCheckDefault">
                                    <a href="#" class="text-dark" id="modal_open_btn" data-toggle="modal"
                                       data-target="#agreeModal"><u>개인정보 수집 및 이용</u></a>을 동의합니다.<span
                                        style="color: rgb(244, 54, 54);">&nbsp;&ast;</span>
                                    <!-- Modal -->
                                    <div class="modal fade" id="agreeModal" tabindex="-1"
                                         aria-labelledby="exampleModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="exampleModalLabel">개인정보 수집 및 이용 동의서</h5>
                                                    <button type="button" class="close" data-dismiss="modal">&times;
                                                    </button>
                                                </div>
                                                <div class="modal-body">
                                                    굿잡 (이하 "회사"라 함)는 이용자의 서비스 이용과 관련하여 아래와 같은 개인정보를 수집, 활용합니다.<br/>
                                                    목적 수집항목 보유 및 이용기간<br/>
                                                    회원가입 필수 이메일, 이름, 성별, 생년월일, 휴대전화번호-회원탈퇴 시 까지<br/>
                                                    선택 신입/경력 여부, 연차, 희망직종, 희망근무지역-회원탈퇴 시 까지<br/>
                                                    소셜계정<br/>
                                                    회원가입필수<br/>
                                                    Payco : 동일인식별번호, 이름, 이메일, 성별, 생년월일<br/>
                                                    Facebook : 동일인식별번호, 이름, 이메일, 성별, 생년월일<br/>
                                                    Kakao : 동일인식별번호, 닉네임/프로필사진, 생년월일, 이메일<br/>
                                                    Google : 동일인식별번호, 이름, 이메일, 성별<br/>
                                                    Twitter : 동일인식별번호, 이름<br/>
                                                    Naver : 동일인식별번호, 이름, 이메일, 성별, 닉네임<br/>
                                                    Apple : 동일인식별번호, 이메일 회원탈퇴 시 까지<br/>
                                                    본인인증 필수<br/>
                                                    이름, 생년월일, 휴대전화번호, 본인인증결과값-인증절차 완료 시까지<br/>
                                                    <br/>
                                                    이용자는 개인정보의 수집 및 이용 동의를 거부할 권리가 있습니다. 다만 동의 거부 시 굿잡 서비스를 이용할 수 없습니다.
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <button type="submit" class="btn bg-gradient-dark w-100">회원가입</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
</body>


<script>

    //Daum 주소 찾기API function
    function sample6_execDaumPostcode() {
        new daum.Postcode({
            oncomplete: function (data) {
                // 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

                // 각 주소의 노출 규칙에 따라 주소를 조합한다.
                // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
                var addr = ''; // 주소 변수
                var extraAddr = ''; // 참고항목 변수

                //사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
                if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
                    addr = data.roadAddress;
                } else { // 사용자가 지번 주소를 선택했을 경우(J)
                    addr = data.jibunAddress;
                }

                // 사용자가 선택한 주소가 도로명 타입일때 참고항목을 조합한다.
                if (data.userSelectedType === 'R') {
                    // 법정동명이 있을 경우 추가한다. (법정리는 제외)
                    // 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
                    if (data.bname !== '' && /[동|로|가]$/g.test(data.bname)) {
                        extraAddr += data.bname;
                    }
                    // 건물명이 있고, 공동주택일 경우 추가한다.
                    if (data.buildingName !== '' && data.apartment === 'Y') {
                        extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                    }
                    // 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
                    if (extraAddr !== '') {
                        extraAddr = ' (' + extraAddr + ')';
                    }
                    // 조합된 참고항목을 해당 필드에 넣는다.
                    document.getElementById("sample6_extraAddress").value = extraAddr;

                } else {
                    document.getElementById("sample6_extraAddress").value = '';
                }

                // 우편번호와 주소 정보를 해당 필드에 넣는다.
                document.getElementById('sample6_postcode').value = data.zonecode;
                document.getElementById("sample6_address").value = addr;
                // 커서를 상세주소 필드로 이동한다.
                document.getElementById("sample6_detailAddress").focus();
            }
        }).open();
    }

    //비밀번호1,2 일치 여부 보여주는 fuction
    function passwordConfirm() {
        var password = document.getElementById('comPw1');
        var passwordConfirm = document.getElementById('comPw2');
        var confirmMsg = document.getElementById('confirmMsg')  //확인 메시지
        var correctColor = "#73b973"; //맞았을 때 출력되는 색깔.
        var wrongColor = "#ff0000";   //틀렸을 때 출력되는 색깔.

        if(password.value == passwordConfirm.value) {
            confirmMsg.style.color = correctColor;
            confirmMsg.innerHTML = "비밀번호 일치";
        } else {
            confirmMsg.style.color = wrongColor;
            confirmMsg.innerHTML = "비밀번호 불일치";
        }
    }


    //아이디 중복검사
    //onkeyup이 여기서는 "change keyup"이다!!!
    $('#id_input').on("change keyup", function(){

        console.log("keyup 테스트");
        var comLoginId = $('#id_input').val();			// .id_input에 입력되는 값
        var data = {comLoginId : comLoginId}				// '컨트롤에 넘길 데이터 이름' : '데이터(.id_input에 입력되는 값)'

        $.ajax({
            type : "post",
            url : "/com/check",
            data : data,
            success : function(result){
                if(result != 'fail'){
                    $('.id_input_re_1').css("display","inline-block");
                    $('.id_input_re_2').css("display", "none");
                } else {
                    $('.id_input_re_2').css("display","inline-block");
                    $('.id_input_re_1').css("display", "none");
                }

            }
        });
    });


    // 사론님 로그인 중복체크(정규표현식) 여기서 사용은 안 함.
    $("#userId").blur(function () {
        let idError = $("#idError");
        idError.css("color", "#ff6289");

        ///ajax 조건식//
        $.ajax({
            url: '/idCheck',
            type: 'get',
            data: {userId : $("#userId").val()},
            dataType: 'text',
            success: function (check) {	// 통신 성공 시 "true" 혹은 "false" 반환
                if (check === "true") { // 아이디가 이미 존재함
                    //console.log(check);	// 확인용
                    idError.show().text("중복 아이디입니다.");
                    return resId=false;
                } else {	// "false" 일 경우 - 아이디가 존재하지 않을 경우
                    //console.log(check);	// 확인용
                    let regExp = /^[a-z0-9_-]{5,20}$/g; //아이디 정규식(영문 소문자, 숫자, 특수문자(-,_) 만 가능)
                    let id = $("#userId").val();

                    if (id === null || id === "") { //값이 없을 때
                        idError.show().text("필수 정보입니다.");
                        return resId=false;
                    } else if (!regExp.test(id)) { //정규식에 맞지 않을 때
                        idError.show().text("5~20자의 영문 소문자, 숫자와 특수기호(_),(-)만 사용 가능합니다.");
                        return resId=false;
                    } else { //조건에 맞는 아이디일 때 true 반환
                        idError.css("color", "#77ab59");
                        idError.show().text("멋진 아이디네요!");
                        return resId = true;
                    }
                }
            },
            error: function () {
                console.log("아이디 체크 오류");
            }
        });
    });


    //다른분 아이디 중복체크 - 여기서는 사용 안함.
    var $id = $("#id");
    // 아이디 정규식
    $id.on("keyup", function() { // 키보드에서 손을 땠을 때 실행
        var regExp = /^[a-z]+[a-z0-9]{5,15}$/g;

        if (!regExp.test($id.val())) { // id 가 공백인 경우 체크
            idchk = false;
            $id.html("<span id='check'>사용할 수 없는 아이디입니다.</span>");
            $("#check").css({
                "color" : "#FA3E3E",
                "font-weight" : "bold",
                "font-size" : "10px"
            })
        } else { // 공백아니면 중복체크
            $.ajax({
                type : "POST", // http 방식
                url : "/com/register", // ajax 통신 url
                data : { // ajax 내용 => 파라미터 : 값 이라고 생각해도 무방
                    "type" : "user",
                    "id" : $id.val()
                },
                success : function(data) {
                    if (data == 1) { // 1이면 중복
                        idchk = false;
                        $id.html("<span id='check'>이미 존재하는 아이디입니다</span>")
                        $("#check").css({
                            "color" : "#FA3E3E",
                            "font-weight" : "bold",
                            "font-size" : "10px"

                        })
                        //console.log("중복아이디");
                    } else { // 아니면 중복아님
                        idchk = true;
                        $id.html("<span id='check'>사용가능한 아이디입니다</span>")

                        $("#check").css({
                            "color" : "#0D6EFD",
                            "font-weight" : "bold",
                            "font-size" : "10px"

                        })
                        //console.log("중복아닌 아이디");
                    }
                }
            })
        }
    });

</script>
</html>